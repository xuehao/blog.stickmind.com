
<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

  <link
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">

  <link id="dark-theme-style" rel="stylesheet" type="text/css"   media="(prefers-color-scheme: dark)"      href="./theme/stylesheet/dark-theme.min.css">

  <link id="pygments-dark-theme" rel="stylesheet" type="text/css"      media="(prefers-color-scheme: dark)"      href="./theme/pygments/monokai.min.css">
  <link id="pygments-light-theme" rel="stylesheet" type="text/css"     media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"      href="./theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/solid.css">


  <link href="https://blog.stickmind.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
    title="薛浩的博客 - 追求卓越，宁静致远 Atom">


  <link rel="shortcut icon" href="theme/img/notebook.png" type="image/x-icon">
  <link rel="icon" href="theme/img/notebook.png" type="image/x-icon">





<meta name="author" content="xuehao" />
<meta name="description" content="学习搭建C语言编程环境，学习编译开源C程序库，利用现有代码解决问题。" />
<meta name="keywords" content="C Programming">


  <meta property="og:site_name" content="薛浩的博客 - 追求卓越，宁静致远"/>
  <meta property="og:title" content="搭建 C 的编程环境"/>
  <meta property="og:description" content="学习搭建C语言编程环境，学习编译开源C程序库，利用现有代码解决问题。"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="./build-a-c-programming-environment.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2019-12-21 00:13:00+08:00"/>
  <meta property="article:modified_time" content="2019-12-18 22:06:00+08:00"/>
  <meta property="article:author" content="./author/xuehao.html">
  <meta property="article:section" content="笔记"/>
  <meta property="article:tag" content="C Programming"/>
  <meta property="og:image" content="">

  <title>薛浩的博客 - 追求卓越，宁静致远 &ndash; 搭建 C 的编程环境</title>

</head>

<body >
  <aside>
    <div>
      <a href="./">
        <img src="./theme/img/profile.png" alt="xuehao's blog" title="xuehao's blog">
      </a>

      <h1>
        <a href="./">xuehao's blog</a>
      </h1>

<p>To make your dreams happen</p>

      <nav>
        <ul class="list">


          <li>
            <a target="_self"
              href="./pages/projects-zh-CN.html">
              Projects
            </a>
          </li>

          <li>
            <a target="_self" href="https://www.stickmind.com">resume</a>
          </li>
        </ul>
      </nav>

      <ul class="social">
        <li>
          <a  class="sc-github" href="https://github.com/xuehao" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        </li>
        <li>
          <a  class="sc-envelope" href="mailto:xuehao0618@icloud.com" target="_blank">
            <i class="fas fa-envelope"></i>
          </a>
        </li>
        <li>
          <a  class="sc-rss" href="/feeds/all.atom.xml" target="_blank">
            <i class="fas fa-rss"></i>
          </a>
        </li>
      </ul>
    </div>

  </aside>
  <main>

    <nav>
      <a href="./">Home</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="https://blog.stickmind.com/feeds/all.atom.xml">Atom</a>

    </nav>

<article class="single">
  <header>
      
    <h1 id="build-a-c-programming-environment">搭建 C 的编程环境</h1>
    <p>
      Posted on 2019-12-21 in <a href="./category/bi-ji.html">笔记</a>

    </p>
  </header>


  <div>
    <h2>0. 目标</h2>
<ul>
<li>学习创建个人 <em>root</em> 系统</li>
<li>学习从源码编译常用程序库</li>
<li>构建包含库的 C 程序</li>
</ul>
<h2>1. 创建个人 root 系统</h2>
<p>所谓的个人 <em>root</em> 系统，其实就是避免把软件安装到系统路径。这样我们可以方便的查看 <em>root</em> 目录下的文件，审查所安装软件的具体行为，而不必到系统目录中查找。创建个人 <em>root</em> 系统还可以避免使用系统 <em>root</em> 权限。<sup id="sf-build-a-c-programming-environment-1-back"><a href="#sf-build-a-c-programming-environment-1" class="simple-footnote" title="Ben Klemens. C 程序设计新思维, 第 2 版[M]. 赵岩, 译. 北京: 人民邮电出版社, 2018.">1</a></sup></p>
<p>创建 <em>root</em> 系统目录：</p>
<div class="highlight"><pre><span></span><code>$ mkdir ~/root <span class="c1"># 用于保存非系统程序库</span>
</code></pre></div>

<p>将个人 <em>root</em> 系统目录添加到系统路径：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/root/bin:<span class="nv">$PATH</span> <span class="c1"># 以 zsh 举例，添加到 .zshrc</span>
</code></pre></div>

<p>其实，这样的个人路径，在类似 <em>Ubuntu</em> 的系统中已经默认存在了，即个人文件夹下的 <code>.local</code> 目录。如果你愿意，完全可以使用该目录，而且不需要去修改系统路径。</p>
<h2>2. 从源码编译程序库</h2>
<p>学习 C 语言完全可以像学习 Python 那样，直接使用现成的库。在 C 语言几十年的发展过程中，除了标准库的更新外，还产生了无数质量上乘的第三方库。利用这些库，我们可以更愉快的编程了。</p>
<p>下面会以 <em>GSL</em> 库为例，介绍类似第三方库的安装和使用方法，为后续学习其他的库奠定基础。</p>
<p>下载 <code>GSL</code> 源码并编译安装：</p>
<div class="highlight"><pre><span></span><code>$ wget  http://mirrors.ustc.edu.cn/gnu/gsl/gsl-2.6.tar.gz
$ tar xvzf gsl-2.6.tar.gz
$ <span class="nb">cd</span> gsl-2.6
$ ./configure --prefix<span class="o">=</span><span class="nv">$HOME</span>/root <span class="c1"># 使用 prefix 参数指定安装目录</span>
$ make <span class="o">&amp;&amp;</span> make install
</code></pre></div>

<p>该程序库将被添加到个人 <em>root</em> 系统，可以去目录中查看具体安装了哪些东西。</p>
<h2>3. 构建包含库的 C 程序</h2>
<p>编写测试程序：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 文件名：gsl_erf.c</span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="c1">        //erf, sqrt 等</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="c1">       //printf 等</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;gsl/gsl_cdf.h&gt;</span><span class="cp"></span>

<span class="kt">int</span>
<span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">bottom_tail</span> <span class="o">=</span> <span class="n">gsl_cdf_gaussian_P</span><span class="p">(</span><span class="mf">-1.96</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Area between [-1.96, 1.96]: %g</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">bottom_tail</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>编写 <em>Makefile</em> 文件，通过 <em>-I</em> 指定库的头文件搜索路径；通过 <em>-L</em> 指定库的搜索路径：</p>
<div class="highlight"><pre><span></span><code><span class="nv">CFLAGS</span><span class="o">=</span>-I<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/root/include -g -Wall -std<span class="o">=</span>gnu11 -O3
<span class="nv">LDLIBS</span><span class="o">=</span>-L<span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/root/lib -lgsl -lgslcblas -lm
</code></pre></div>

<p>或者使用 <em>GSL</em> 自带的配置信息，该命令会自动计算出相关的路径：</p>
<div class="highlight"><pre><span></span><code><span class="nv">CFLAGS</span><span class="o">=</span><span class="sb">`</span>gsl-config --cflags<span class="sb">`</span> -g -Wall -std<span class="o">=</span>gnu11 -O3
<span class="nv">LDLIBS</span><span class="o">=</span><span class="sb">`</span>gsl-config --libs<span class="sb">`</span>
</code></pre></div>

<p>编译测试程序：</p>
<div class="highlight"><pre><span></span><code>$ make gsl_erf
</code></pre></div>

<p><em>Makefile</em> 编译过程的套路一般为：</p>
<ul>
<li>设置编译器选项的变量：<em>CFLAGS</em> 为我们提供了编译器的一些选项</li>
<li>设置连接器选项的变量：<em>LDLIBS</em> 为我们提供了连接器的一些选项。</li>
<li>使用 make 等工具将变量转换成真正的编译和连接的命令</li>
</ul>
<table>
<thead>
<tr>
<th align="center">常用编译器选项</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">-g</td>
<td align="center">加入调试符号</td>
</tr>
<tr>
<td align="center">-Wall</td>
<td align="center">添加编译器警告</td>
</tr>
<tr>
<td align="center">-std=gun11</td>
<td align="center">编译器版本为 C11</td>
</tr>
<tr>
<td align="center">-O3</td>
<td align="center">优化等级为 3</td>
</tr>
<tr>
<td align="center">-o</td>
<td align="center">指定输出的文件名，默认文件名为 a.out</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center">常用连接器选项</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">-I(大写的 i)</td>
<td align="center">添加头文件搜索路径</td>
</tr>
<tr>
<td align="center">-L</td>
<td align="center">添加库文件搜索路径</td>
</tr>
<tr>
<td align="center">-l(小写的 L)</td>
<td align="center">指定需要连接的库：<code>-lgsl</code> 自动连接名为 libgsl.a 库</td>
</tr>
</tbody>
</table>
<p>运行测试程序：</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$HOME</span>/root/lib:<span class="nv">$LD_LIBRARY_PATH</span> <span class="c1"># 指定库路径</span>
$ ./gsl_erf
Area between <span class="o">[</span>-1.96, <span class="m">1</span>.96<span class="o">]</span>: <span class="m">0</span>.950004
</code></pre></div>

<p>对于运行时需要连接共享库的程序，和编译过程一样，同样需要指定库的路径，可以通过修改 <em>LD_LIBRARY_PATH</em> 变量实现。</p>
<hr>
<p><em>参考文献:</em></p><ol class="simple-footnotes"><li id="sf-build-a-c-programming-environment-1">Ben Klemens. C 程序设计新思维, 第 2 版[M]. 赵岩, 译. 北京: 人民邮电出版社, 2018. <a href="#sf-build-a-c-programming-environment-1-back" class="simple-footnote-back">↩</a></li></ol>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/c-programming.html">C Programming</a>
    </p>
  </div>





</article>

    <footer>
<p>
  薛浩 &copy; 2021 |

Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
<script id="dark-theme-script" src="./theme/dark-theme/dark-theme.min.js"
  data-enable-auto-detect-theme="True"
  data-default-theme="light" type="text/javascript">
  </script>
</p>
<p>
  <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"
    target="_blank">
    <img alt="Creative Commons License" title="Creative Commons License" style="border-width:0"  src="./theme/img/cc/by-sa.png"  width="80" height="15" />
  </a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " 薛浩的博客 - 追求卓越，宁静致远 ",
  "url" : ".",
  "image": "",
  "description": "BLOG.STICKMIND.COM - 薛浩的博客 - 严谨、有趣、持续更新：数学、编程、统计、英语、音乐、摄影……"
}
</script>

</body>

</html>